const t=require("events").EventEmitter,e=require("util");process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();const n=[7,8],o=[1,2],r=["none","even","mark","odd","space"],i=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;let u=new ArrayBuffer(0);function h(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function d(e,u,d){t.call(this);let y,m=this,w=Array.prototype.slice.call(arguments);if("function"!=typeof(d=w.pop())&&(d=null),void 0!==(u="function"!=typeof u&&u||{}).autoOpen&&null!==u.autoOpen||(u.autoOpen=!0),d=d||function(t){t&&m.emit("error",t)},u.baudRate=u.baudRate||u.baudrate||s,u.dataBits=u.dataBits||u.databits||p,-1===n.indexOf(u.dataBits))return y=new Error('Invalid "databits": '+u.dataBits),void d(y);if(u.stopBits=u.stopBits||u.stopbits||l,-1===o.indexOf(u.stopBits))return y=new Error('Invalid "stopbits": '+u.stopbits),void d(y);if(u.parity=u.parity||a,-1===r.indexOf(u.parity))return y=new Error('Invalid "parity": '+u.parity),void d(y);if(!e)return y=new Error("Invalid port specified: "+e),void d(y);if(u.rtscts=c,u.flowControl||u.flowcontrol){let t=u.flowControl||u.flowcontrol;if("boolean"==typeof t)u.rtscts=!0;else{if(!t.every((function(t){let e=t.toUpperCase(),n=i.indexOf(e);if(n<0){let t=new Error('Invalid "flowControl": '+e+". Valid options: "+i.join("",""));return d(t),!1}switch(n){case 0:u.rtscts=!0}return!0})))return}}if(u.bufferSize=u.bufferSize||u.buffersize||f,u.serial=u.serial||"undefined"!=typeof chrome&&chrome.serial,!u.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=h(u),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":y=new Error("Disconnected"),m.options.disconnectedCallback?m.options.disconnectedCallback(y):m.emit("disconnect",y),m.connectionId>=0&&m.close()}})),this.path=e,this.isOpen=!1,this.baudRate=this.options.baudRate,u.autoOpen&&process.nextTick((function(){m.open(d)}))}function y(t){let e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t[e];return e}function m(t){let e=new Buffer(t.byteLength),n=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=n[t];return e}function w(t){return/Int(8|16|32)Array|Uint(8|8Clamped|16|32)Array|Float(32|64)Array|ArrayBuffer/gi.test({}.toString.call(t))}e.inherits(d,t),d.prototype.connectionId=-1,d.prototype.open=function(t){let e={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,e,this.proxy("onOpen",t))},d.prototype.onOpen=function(t,e){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=e.connectionId,-1!==this.connectionId?(this.isOpen=!0,this.emit("open",e),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,e)):this.emit("error",new Error("Could not open port.")))},d.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(m(t.data)):this.emit("data",m(t.data)))},d.prototype.write=function(t,e="utf8",n=(()=>{})){if("string"==typeof e||e instanceof String?"utf8"!==e&&console.warn("Only utf8 encoding is supported for strings."):(n=e,e="utf8"),this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");return"function"==typeof n&&n(t),void this.emit("error",t)}"string"==typeof t&&(t=function(t){let e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return e}(t)),t instanceof ArrayBuffer||(t=y(t)),t=function(){let t=[].slice.call(arguments);if(t.length<=0||!w(t[0]))return new Uint8Array(0).buffer;let e=t.reduce((function(t,e,n){if(0===n)return t;if(!w(e))return t;let o=new Uint8Array(t.byteLength+e.byteLength);return o.set(new Uint8Array(t),0),o.set(new Uint8Array(e),t.byteLength),o.buffer}),t[0]);return e}(u,t),u=new ArrayBuffer(0),this.options.serial.send(this.connectionId,t,(function(e){"pending"===e.error&&(u=t),"function"==typeof n&&n(chrome.runtime.lastError,e)}))},d.prototype.close=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},d.prototype.onClose=function(t,e){this.connectionId=-1,this.isOpen=!1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,e)},d.prototype.flush=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");return void("function"==typeof t?t(e):this.emit("error",e))}let e=this;this.options.serial.flush(this.connectionId,(function(n){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,n):e.emit("error",chrome.runtime.lastError):t(null,n)}))},d.prototype.drain=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else"function"==typeof t&&t()},d.prototype.pause=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!0,t)},d.prototype.resume=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!1,t)},d.prototype.update=function(t={},e=(()=>{})){if(this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");"function"==typeof e?e(t):this.emit("error",t)}else this.options.serial.update(this.connectionId,{bitrate:t.baudRate},e)},d.prototype.proxy=function(){let t=this,e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];let n=e.splice(0,1)[0];return function(){let o=[];for(let t=0;t<arguments.length;t++)o[t]=arguments[t];let r=e.concat(o);t[n].apply(t,r)}},d.prototype.set=function(t,e){this.options.serial.setControlSignals(this.connectionId,t,(function(t){e(chrome.runtime.lastError,t)}))},d.prototype.get=function(t,e){this.options.serial.getControlSignals(this.connectionId,(function(t){e(chrome.runtime.lastError,t)}))},d.list=async function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(e=>{chrome.serial.getDevices((function(n){let o=new Array(n.length);for(let t=0;t<n.length;t++)o[t]={comName:n[t].path,path:n[t].path,manufacturer:n[t].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(n[t].vendorId||0).toString(16),productId:"0x"+(n[t].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,o),e(o)}))});{let e=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(e,null),Promise.reject(e)}},module.exports={SerialPort:d,list:d.list,buffer2ArrayBuffer:y,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
