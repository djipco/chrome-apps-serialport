const t=require("events").EventEmitter,e=require("util");process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();const o=[7,8],n=[1,2],i=["none","even","mark","odd","space"],r=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;let h=[];function d(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function u(e,h,u){t.call(this);let y=this;this.sending=!1;let m,w=Array.prototype.slice.call(arguments);if("function"!=typeof(u=w.pop())&&(u=null),void 0!==(h="function"!=typeof h&&h||{}).autoOpen&&null!==h.autoOpen||(h.autoOpen=!0),u=u||function(t){t&&y.emit("error",t)},h.baudRate=h.baudRate||h.baudrate||s,h.dataBits=h.dataBits||h.databits||p,-1===o.indexOf(h.dataBits))return m=new Error('Invalid "databits": '+h.dataBits),void u(m);if(h.stopBits=h.stopBits||h.stopbits||l,-1===n.indexOf(h.stopBits))return m=new Error('Invalid "stopbits": '+h.stopbits),void u(m);if(h.parity=h.parity||a,-1===i.indexOf(h.parity))return m=new Error('Invalid "parity": '+h.parity),void u(m);if(!e)return m=new Error("Invalid port specified: "+e),void u(m);if(h.rtscts=c,h.flowControl||h.flowcontrol){let t=h.flowControl||h.flowcontrol;if("boolean"==typeof t)h.rtscts=!0;else{if(!t.every((function(t){let e=t.toUpperCase(),o=r.indexOf(e);if(o<0){let t=new Error('Invalid "flowControl": '+e+". Valid options: "+r.join(""));return u(t),!1}switch(o){case 0:h.rtscts=!0}return!0})))return}}if(h.bufferSize=h.bufferSize||h.buffersize||f,h.serial=h.serial||"undefined"!=typeof chrome&&chrome.serial,!h.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=d(h),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":m=new Error("Disconnected"),y.options.disconnectedCallback?y.options.disconnectedCallback(m):y.emit("disconnect",m),y.connectionId>=0&&y.close()}})),this.path=e,this.isOpen=!1,this.baudRate=this.options.baudRate,h.autoOpen&&process.nextTick((function(){y.open(u)}))}function y(t){return new Uint8Array(t).buffer}function m(t){let e=new Buffer(t.byteLength),o=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=o[t];return e}e.inherits(u,t),u.prototype.connectionId=-1,u.prototype.open=function(t){let e={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,e,this.proxy("onOpen",t))},u.prototype.onOpen=function(t,e){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=e.connectionId,-1!==this.connectionId?(this.isOpen=!0,this.emit("open",e),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,e)):this.emit("error",new Error("Could not open port.")))},u.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(m(t.data)):this.emit("data",m(t.data)))},u.prototype.write=function(t,e="utf8",o=(()=>{})){if("string"==typeof e||e instanceof String||(o=e,e="utf8"),"utf8"!==e&&console.warn("Only utf8 encoding is supported for strings."),this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");return"function"==typeof o&&o(t),void this.emit("error",t)}"string"==typeof t&&(t=function(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return e}(t)),t instanceof ArrayBuffer||(t=y(t)),o(),this._processBuffer(t)},u.prototype._processBuffer=function(t){t&&h.push(t),this.sending||(this.sending=!0,this.options.serial.send(this.connectionId,h[0],function(t){"pending"===t.error?console.warn("You cannot send serial data while another send is pending. Retrying."):t.error?(console.warn("Sending serial data failed. Error: "+t.error),h=[]):h.shift(),this.sending=!1,h.length>0&&setImmediate(this._processBuffer.bind(this))}.bind(this)))},u.prototype.close=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},u.prototype.onClose=function(t,e){this.connectionId=-1,this.isOpen=!1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,e)},u.prototype.flush=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");return void("function"==typeof t?t(e):this.emit("error",e))}let e=this;this.options.serial.flush(this.connectionId,(function(o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,o):e.emit("error",chrome.runtime.lastError):t(null,o)}))},u.prototype.drain=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else"function"==typeof t&&t()},u.prototype.pause=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!0,t)},u.prototype.resume=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!1,t)},u.prototype.update=function(t={},e=(()=>{})){if(this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");"function"==typeof e?e(t):this.emit("error",t)}else this.options.serial.update(this.connectionId,{bitrate:t.baudRate},e)},u.prototype.proxy=function(){let t=this,e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];let o=e.splice(0,1)[0];return function(){let n=[];for(let t=0;t<arguments.length;t++)n[t]=arguments[t];let i=e.concat(n);t[o].apply(t,i)}},u.prototype.set=function(t,e){this.options.serial.setControlSignals(this.connectionId,t,(function(t){e(chrome.runtime.lastError,t)}))},u.prototype.get=function(t,e){this.options.serial.getControlSignals(this.connectionId,(function(t){e(chrome.runtime.lastError,t)}))},u.list=async function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(e=>{chrome.serial.getDevices((function(o){let n=new Array(o.length);for(let t=0;t<o.length;t++)n[t]={comName:o[t].path,path:o[t].path,manufacturer:o[t].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(o[t].vendorId||0).toString(16),productId:"0x"+(o[t].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,n),e(n)}))});{let e=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(e,null),Promise.reject(e)}},module.exports={SerialPort:u,list:u.list,buffer2ArrayBuffer:y,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
