const t=require("events").EventEmitter,o=require("util");process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();const r=[7,8],e=[1,2],n=["none","even","mark","odd","space"],i=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;function u(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function d(o,d,h,y){t.call(this);var m,v=this,w=Array.prototype.slice.call(arguments);if("function"!=typeof(y=w.pop())&&(y=null),null==h&&(h=!0),y=y||function(t){t&&v.emit("error",t)},(d="function"!=typeof d&&d||{}).baudRate=d.baudRate||d.baudrate||s,d.dataBits=d.dataBits||d.databits||p,-1===r.indexOf(d.dataBits))return m=new Error('Invalid "databits": '+d.dataBits),void y(m);if(d.stopBits=d.stopBits||d.stopbits||l,-1===e.indexOf(d.stopBits))return m=new Error('Invalid "stopbits": '+d.stopbits),void y(m);if(d.parity=d.parity||a,-1===n.indexOf(d.parity))return m=new Error('Invalid "parity": '+d.parity),void y(m);if(!o)return m=new Error("Invalid port specified: "+o),void y(m);if(d.rtscts=c,d.flowControl||d.flowcontrol){var I=d.flowControl||d.flowcontrol;if("boolean"==typeof I)d.rtscts=!0;else{var E=I.every((function(t){var o=t.toUpperCase(),r=i.indexOf(o);if(r<0){var e=new Error('Invalid "flowControl": '+o+". Valid options: "+i.join("",""));return y(e),!1}switch(r){case 0:d.rtscts=!0}return!0}));if(!E)return}}if(d.bufferSize=d.bufferSize||d.buffersize||f,d.serial=d.serial||"undefined"!=typeof chrome&&chrome.serial,!d.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=u(d),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":m=new Error("Disconnected"),v.options.disconnectedCallback?v.options.disconnectedCallback(m):v.emit("disconnect",m),v.connectionId>=0&&v.close()}})),this.path=o,h&&process.nextTick((function(){v.open(y)}))}function h(t){for(var o=new ArrayBuffer(t.length),r=new Uint8Array(o),e=0;e<t.length;e++)r[e]=t[e];return o}function y(t){for(var o=new Buffer(t.byteLength),r=new Uint8Array(t),e=0;e<o.length;++e)o[e]=r[e];return o}o.inherits(d,t),d.prototype.connectionId=-1,d.prototype.open=function(t){var o={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,o,this.proxy("onOpen",t))},d.prototype.onOpen=function(t,o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=o.connectionId,-1!==this.connectionId?(this.emit("open",o),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,o)):this.emit("error",new Error("Could not open port.")))},d.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(y(t.data)):this.emit("data",y(t.data)))},d.prototype.write=function(t,o){if(this.connectionId<0){var r=new Error("Serialport not open.");"function"==typeof o?o(r):this.emit("error",r)}else"string"==typeof t&&(t=function(t){for(var o=new ArrayBuffer(t.length),r=new Uint8Array(o),e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return o}(t)),t instanceof ArrayBuffer==!1&&(t=h(t)),this.options.serial.send(this.connectionId,t,(function(t){"function"==typeof o&&o(chrome.runtime.lastError,t)}))},d.prototype.close=function(t){if(this.connectionId<0){var o=new Error("Serialport not open.");"function"==typeof t?t(o):this.emit("error",o)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},d.prototype.onClose=function(t,o){this.connectionId=-1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,o)},d.prototype.flush=function(t){if(this.connectionId<0){var o=new Error("Serialport not open.");"function"==typeof t?t(o):this.emit("error",o)}else{var r=this;this.options.serial.flush(this.connectionId,(function(o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,o):r.emit("error",chrome.runtime.lastError):t(null,o)}))}},d.prototype.drain=function(t){if(this.connectionId<0){var o=new Error("Serialport not open.");"function"==typeof t?t(o):this.emit("error",o)}else"function"==typeof t&&t()},d.prototype.proxy=function(){for(var t=this,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var e=o.splice(0,1)[0],n=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=o.concat(r);t[e].apply(t,i)};return n},d.prototype.set=function(t,o){this.options.serial.setControlSignals(this.connectionId,t,(function(t){o(chrome.runtime.lastError,t)}))},d.prototype.isOpen=function(){return this.connectionId>-1},d.list=function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(o=>{chrome.serial.getDevices((function(r){for(var e=new Array(r.length),n=0;n<r.length;n++)e[n]={comName:r[n].path,path:r[n].path,manufacturer:r[n].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(r[n].vendorId||0).toString(16),productId:"0x"+(r[n].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,e),o(e)}))});var o=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(o,null),Promise.reject(o)},module.exports={SerialPort:d,list:d.list,buffer2ArrayBuffer:h,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
