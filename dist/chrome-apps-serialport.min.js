const t=require("events").EventEmitter,e=require("util");process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();const o=[7,8],n=[1,2],i=["none","even","mark","odd","space"],r=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;function u(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function h(e,h,d){t.call(this);let y,m=this,w=Array.prototype.slice.call(arguments);if("function"!=typeof(d=w.pop())&&(d=null),void 0!==(h="function"!=typeof h&&h||{}).autoOpen&&null!==h.autoOpen||(h.autoOpen=!0),d=d||function(t){t&&m.emit("error",t)},h.baudRate=h.baudRate||h.baudrate||s,h.dataBits=h.dataBits||h.databits||p,-1===o.indexOf(h.dataBits))return y=new Error('Invalid "databits": '+h.dataBits),void d(y);if(h.stopBits=h.stopBits||h.stopbits||l,-1===n.indexOf(h.stopBits))return y=new Error('Invalid "stopbits": '+h.stopbits),void d(y);if(h.parity=h.parity||a,-1===i.indexOf(h.parity))return y=new Error('Invalid "parity": '+h.parity),void d(y);if(!e)return y=new Error("Invalid port specified: "+e),void d(y);if(h.rtscts=c,h.flowControl||h.flowcontrol){let t=h.flowControl||h.flowcontrol;if("boolean"==typeof t)h.rtscts=!0;else{if(!t.every((function(t){let e=t.toUpperCase(),o=r.indexOf(e);if(o<0){let t=new Error('Invalid "flowControl": '+e+". Valid options: "+r.join("",""));return d(t),!1}switch(o){case 0:h.rtscts=!0}return!0})))return}}if(h.bufferSize=h.bufferSize||h.buffersize||f,h.serial=h.serial||"undefined"!=typeof chrome&&chrome.serial,!h.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=u(h),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":y=new Error("Disconnected"),m.options.disconnectedCallback?m.options.disconnectedCallback(y):m.emit("disconnect",y),m.connectionId>=0&&m.close()}})),this.path=e,this.isOpen=!1,this.baudRate=this.options.baudRate,h.autoOpen&&process.nextTick((function(){m.open(d)}))}function d(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t[e];return e}function y(t){let e=new Buffer(t.byteLength),o=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=o[t];return e}e.inherits(h,t),h.prototype.connectionId=-1,h.prototype.open=function(t){let e={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,e,this.proxy("onOpen",t))},h.prototype.onOpen=function(t,e){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=e.connectionId,-1!==this.connectionId?(this.isOpen=!0,this.emit("open",e),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,e)):this.emit("error",new Error("Could not open port.")))},h.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(y(t.data)):this.emit("data",y(t.data)))},h.prototype.write=function(t,e="utf8",o=(()=>{})){if(this.connectionId<0){let t=new Error("Serialport not open.");return this.isOpen=!1,void("function"==typeof o?o(t):this.emit("error",t))}"string"==typeof t&&(t=function(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return e}(t)),"utf8"!==e&&console.warn("Only utf8 encoding is supported for strings."),t instanceof ArrayBuffer||(t=d(t)),this.options.serial.send(this.connectionId,t,(function(t){"function"==typeof o&&o(chrome.runtime.lastError,t)}))},h.prototype.close=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},h.prototype.onClose=function(t,e){this.connectionId=-1,this.isOpen=!1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,e)},h.prototype.flush=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");return void("function"==typeof t?t(e):this.emit("error",e))}let e=this;this.options.serial.flush(this.connectionId,(function(o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,o):e.emit("error",chrome.runtime.lastError):t(null,o)}))},h.prototype.drain=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else"function"==typeof t&&t()},h.prototype.pause=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!0,t)},h.prototype.resume=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!1,t)},h.prototype.update=function(t={},e=(()=>{})){if(this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");"function"==typeof e?e(t):this.emit("error",t)}else this.options.serial.update(this.connectionId,{bitrate:t.baudRate},e)},h.prototype.proxy=function(){let t=this,e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];let o=e.splice(0,1)[0];return function(){let n=[];for(let t=0;t<arguments.length;t++)n[t]=arguments[t];let i=e.concat(n);t[o].apply(t,i)}},h.prototype.set=function(t,e){this.options.serial.setControlSignals(this.connectionId,t,(function(t){e(chrome.runtime.lastError,t)}))},h.prototype.get=function(t,e){this.options.serial.getControlSignals(this.connectionId,(function(t){e(chrome.runtime.lastError,t)}))},h.list=async function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(e=>{chrome.serial.getDevices((function(o){let n=new Array(o.length);for(let t=0;t<o.length;t++)n[t]={comName:o[t].path,path:o[t].path,manufacturer:o[t].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(o[t].vendorId||0).toString(16),productId:"0x"+(o[t].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,n),e(n)}))});{let e=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(e,null),Promise.reject(e)}},module.exports={SerialPort:h,list:h.list,buffer2ArrayBuffer:d,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
