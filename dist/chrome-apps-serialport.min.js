const t=require("events").EventEmitter,r=require("util");require("nwjs-j5-fix").fix();var o=[7,8],e=[1,2],n=["none","even","mark","odd","space"],i=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;function u(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function d(r,d,h,y){t.call(this);var m,v=this,w=Array.prototype.slice.call(arguments);if("function"!=typeof(y=w.pop())&&(y=null),null==h&&(h=!0),y=y||function(t){t&&v.emit("error",t)},(d="function"!=typeof d&&d||{}).baudRate=d.baudRate||d.baudrate||s,d.dataBits=d.dataBits||d.databits||p,-1===o.indexOf(d.dataBits))return m=new Error('Invalid "databits": '+d.dataBits),void y(m);if(d.stopBits=d.stopBits||d.stopbits||l,-1===e.indexOf(d.stopBits))return m=new Error('Invalid "stopbits": '+d.stopbits),void y(m);if(d.parity=d.parity||a,-1===n.indexOf(d.parity))return m=new Error('Invalid "parity": '+d.parity),void y(m);if(!r)return m=new Error("Invalid port specified: "+r),void y(m);if(d.rtscts=c,d.flowControl||d.flowcontrol){var I=d.flowControl||d.flowcontrol;if("boolean"==typeof I)d.rtscts=!0;else{var E=I.every((function(t){var r=t.toUpperCase(),o=i.indexOf(r);if(o<0){var e=new Error('Invalid "flowControl": '+r+". Valid options: "+i.join("",""));return y(e),!1}switch(o){case 0:d.rtscts=!0}return!0}));if(!E)return}}if(d.bufferSize=d.bufferSize||d.buffersize||f,d.serial=d.serial||"undefined"!=typeof chrome&&chrome.serial,!d.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=u(d),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":m=new Error("Disconnected"),v.options.disconnectedCallback?v.options.disconnectedCallback(m):v.emit("disconnect",m),v.connectionId>=0&&v.close()}})),this.path=r,h&&process.nextTick((function(){v.open(y)}))}function h(t){for(var r=new ArrayBuffer(t.length),o=new Uint8Array(r),e=0;e<t.length;e++)o[e]=t[e];return r}function y(t){for(var r=new Buffer(t.byteLength),o=new Uint8Array(t),e=0;e<r.length;++e)r[e]=o[e];return r}r.inherits(d,t),d.prototype.connectionId=-1,d.prototype.open=function(t){var r={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,r,this.proxy("onOpen",t))},d.prototype.onOpen=function(t,r){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=r.connectionId,-1!==this.connectionId?(this.emit("open",r),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,r)):this.emit("error",new Error("Could not open port.")))},d.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(y(t.data)):this.emit("data",y(t.data)))},d.prototype.write=function(t,r){if(this.connectionId<0){var o=new Error("Serialport not open.");"function"==typeof r?r(o):this.emit("error",o)}else"string"==typeof t&&(t=function(t){for(var r=new ArrayBuffer(t.length),o=new Uint8Array(r),e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return r}(t)),t instanceof ArrayBuffer==!1&&(t=h(t)),this.options.serial.send(this.connectionId,t,(function(t){"function"==typeof r&&r(chrome.runtime.lastError,t)}))},d.prototype.close=function(t){if(this.connectionId<0){var r=new Error("Serialport not open.");"function"==typeof t?t(r):this.emit("error",r)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},d.prototype.onClose=function(t,r){this.connectionId=-1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,r)},d.prototype.flush=function(t){if(this.connectionId<0){var r=new Error("Serialport not open.");"function"==typeof t?t(r):this.emit("error",r)}else{var o=this;this.options.serial.flush(this.connectionId,(function(r){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,r):o.emit("error",chrome.runtime.lastError):t(null,r)}))}},d.prototype.drain=function(t){if(this.connectionId<0){var r=new Error("Serialport not open.");"function"==typeof t?t(r):this.emit("error",r)}else"function"==typeof t&&t()},d.prototype.proxy=function(){for(var t=this,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var e=r.splice(0,1)[0],n=function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var i=r.concat(o);t[e].apply(t,i)};return n},d.prototype.set=function(t,r){this.options.serial.setControlSignals(this.connectionId,t,(function(t){r(chrome.runtime.lastError,t)}))},d.prototype.isOpen=function(){return this.connectionId>-1},module.exports={SerialPort:d,list:function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(r=>{chrome.serial.getDevices((function(o){for(var e=new Array(o.length),n=0;n<o.length;n++)e[n]={comName:o[n].path,path:o[n].path,manufacturer:o[n].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(o[n].vendorId||0).toString(16),productId:"0x"+(o[n].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,e),r(e)}))});var r=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(r,null),Promise.reject(r)},buffer2ArrayBuffer:h,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
