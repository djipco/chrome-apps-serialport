const t=require("events").EventEmitter,e=require("util");process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();const o=[7,8],r=[1,2],n=["none","even","mark","odd","space"],i=["RTSCTS"],s=9600,c="none",a=!1,l=8,p=1,f=256;function u(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function d(e,d,h,y){t.call(this);let m,w=this,I=Array.prototype.slice.call(arguments);if("function"!=typeof(y=I.pop())&&(y=null),null==h&&(h=!0),y=y||function(t){t&&w.emit("error",t)},(d="function"!=typeof d&&d||{}).baudRate=d.baudRate||d.baudrate||s,d.dataBits=d.dataBits||d.databits||l,-1===o.indexOf(d.dataBits))return m=new Error('Invalid "databits": '+d.dataBits),void y(m);if(d.stopBits=d.stopBits||d.stopbits||p,-1===r.indexOf(d.stopBits))return m=new Error('Invalid "stopbits": '+d.stopbits),void y(m);if(d.parity=d.parity||c,-1===n.indexOf(d.parity))return m=new Error('Invalid "parity": '+d.parity),void y(m);if(!e)return m=new Error("Invalid port specified: "+e),void y(m);if(d.rtscts=a,d.flowControl||d.flowcontrol){let t=d.flowControl||d.flowcontrol;if("boolean"==typeof t)d.rtscts=!0;else{if(!t.every((function(t){let e=t.toUpperCase(),o=i.indexOf(e);if(o<0){let t=new Error('Invalid "flowControl": '+e+". Valid options: "+i.join("",""));return y(t),!1}switch(o){case 0:d.rtscts=!0}return!0})))return}}if(d.bufferSize=d.bufferSize||d.buffersize||f,d.serial=d.serial||"undefined"!=typeof chrome&&chrome.serial,!d.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=u(d),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":m=new Error("Disconnected"),w.options.disconnectedCallback?w.options.disconnectedCallback(m):w.emit("disconnect",m),w.connectionId>=0&&w.close()}})),this.path=e,h&&process.nextTick((function(){w.open(y)}))}function h(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t[e];return e}function y(t){let e=new Buffer(t.byteLength),o=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=o[t];return e}e.inherits(d,t),d.prototype.connectionId=-1,d.prototype.open=function(t){let e={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,e,this.proxy("onOpen",t))},d.prototype.onOpen=function(t,e){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=e.connectionId,-1!==this.connectionId?(this.emit("open",e),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,e)):this.emit("error",new Error("Could not open port.")))},d.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(y(t.data)):this.emit("data",y(t.data)))},d.prototype.write=function(t,e){if(this.connectionId<0){let t=new Error("Serialport not open.");"function"==typeof e?e(t):this.emit("error",t)}else"string"==typeof t&&(t=function(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return e}(t)),t instanceof ArrayBuffer||(t=h(t)),this.options.serial.send(this.connectionId,t,(function(t){"function"==typeof e&&e(chrome.runtime.lastError,t)}))},d.prototype.close=function(t){if(this.connectionId<0){let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},d.prototype.onClose=function(t,e){this.connectionId=-1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,e)},d.prototype.flush=function(t){if(this.connectionId<0){let e=new Error("Serialport not open.");return void("function"==typeof t?t(e):this.emit("error",e))}let e=this;this.options.serial.flush(this.connectionId,(function(o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,o):e.emit("error",chrome.runtime.lastError):t(null,o)}))},d.prototype.drain=function(t){if(this.connectionId<0){let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else"function"==typeof t&&t()},d.prototype.proxy=function(){let t=this,e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];let o=e.splice(0,1)[0];return function(){let r=[];for(let t=0;t<arguments.length;t++)r[t]=arguments[t];let n=e.concat(r);t[o].apply(t,n)}},d.prototype.set=function(t,e){this.options.serial.setControlSignals(this.connectionId,t,(function(t){e(chrome.runtime.lastError,t)}))},d.prototype.isOpen=function(){return this.connectionId>-1},d.list=async function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(e=>{chrome.serial.getDevices((function(o){let r=new Array(o.length);for(let t=0;t<o.length;t++)r[t]={comName:o[t].path,path:o[t].path,manufacturer:o[t].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(o[t].vendorId||0).toString(16),productId:"0x"+(o[t].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,r),e(r)}))});{let e=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(e,null),Promise.reject(e)}},module.exports={SerialPort:d,list:d.list,buffer2ArrayBuffer:h,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
