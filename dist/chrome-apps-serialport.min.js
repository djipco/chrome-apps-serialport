const t=require("events").EventEmitter,e=require("util"),o=[7,8],n=[1,2],i=["none","even","mark","odd","space"],r=["RTSCTS"],s=9600,a="none",c=!1,p=8,l=1,f=256;function h(t){switch(t.dataBits){case 7:t.dataBits="seven";break;case 8:t.dataBits="eight"}switch(t.stopBits){case 1:t.stopBits="one";break;case 2:t.stopBits="two"}switch(t.parity){case"none":t.parity="no"}return t}function d(e,d,u){t.call(this);let y=this;this.sending=!1,this._sendBufferArray=[],this._sendCallbackArray=[],process&&process.versions.nw&&parseFloat(process.versions.nw)>=.13&&require("nwjs-j5-fix").fix();let m,w=Array.prototype.slice.call(arguments);if("function"!=typeof(u=w.pop())&&(u=null),void 0!==(d="function"!=typeof d&&d||{}).autoOpen&&null!==d.autoOpen||(d.autoOpen=!0),u=u||function(t){t&&y.emit("error",t)},d.baudRate=d.baudRate||d.baudrate||s,d.dataBits=d.dataBits||d.databits||p,-1===o.indexOf(d.dataBits))return m=new Error('Invalid "databits": '+d.dataBits),void u(m);if(d.stopBits=d.stopBits||d.stopbits||l,-1===n.indexOf(d.stopBits))return m=new Error('Invalid "stopbits": '+d.stopbits),void u(m);if(d.parity=d.parity||a,-1===i.indexOf(d.parity))return m=new Error('Invalid "parity": '+d.parity),void u(m);if(!e)return m=new Error("Invalid port specified: "+e),void u(m);if(d.rtscts=c,d.flowControl||d.flowcontrol){let t=d.flowControl||d.flowcontrol;if("boolean"==typeof t)d.rtscts=!0;else{if(!t.every((function(t){let e=t.toUpperCase(),o=r.indexOf(e);if(o<0){let t=new Error('Invalid "flowControl": '+e+". Valid options: "+r.join(""));return u(t),!1}switch(o){case 0:d.rtscts=!0}return!0})))return}}if(d.bufferSize=d.bufferSize||d.buffersize||f,d.serial=d.serial||"undefined"!=typeof chrome&&chrome.serial,!d.serial)throw new Error("No access to serial ports. Try loading as a Chrome Application.");this.options=h(d),this.options.serial.onReceiveError.addListener((function(t){switch(t.error){case"disconnected":case"device_lost":case"system_error":m=new Error("Disconnected"),y.options.disconnectedCallback?y.options.disconnectedCallback(m):y.emit("disconnect",m),y.connectionId>=0&&y.close()}})),this.path=e,this.isOpen=!1,this.baudRate=this.options.baudRate,d.autoOpen&&process.nextTick((function(){y.open(u)}))}function u(t){return new Uint8Array(t).buffer}function y(t){let e=new Buffer(t.byteLength),o=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=o[t];return e}e.inherits(d,t),d.prototype.connectionId=-1,d.prototype.open=function(t){let e={bitrate:parseInt(this.options.baudRate,10),dataBits:this.options.dataBits,parityBit:this.options.parity,stopBits:this.options.stopBits,ctsFlowControl:this.options.rtscts};this.options.serial.connect(this.path,e,this.proxy("onOpen",t))},d.prototype.onOpen=function(t,e){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError):this.emit("error",chrome.runtime.lastError):(this.connectionId=e.connectionId,-1!==this.connectionId?(this.isOpen=!0,this.emit("open",e),this._reader=this.proxy("onRead"),this.options.serial.onReceive.addListener(this._reader),"function"==typeof t&&t(chrome.runtime.lastError,e)):this.emit("error",new Error("Could not open port.")))},d.prototype.onRead=function(t){t&&this.connectionId===t.connectionId&&(this.options.dataCallback?this.options.dataCallback(y(t.data)):this.emit("data",y(t.data)))},d.prototype.write=function(t,e="utf8",o=(()=>{})){if("string"==typeof e||e instanceof String||(o=e,e="utf8"),"utf8"!==e&&console.warn("Only utf8 encoding is supported for strings."),this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");return"function"==typeof o&&o(t),void this.emit("error",t)}"string"==typeof t&&(t=function(t){let e=new ArrayBuffer(t.length),o=new Uint8Array(e);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return e}(t)),t instanceof ArrayBuffer||(t=u(t)),this._processBuffer(t,o)},d.prototype._processBuffer=function(t,e){t&&this._sendBufferArray.push(t),"function"==typeof e?this._sendCallbackArray.push(e):this._sendCallbackArray.push(()=>{}),this.sending||(this.sending=!0,this.options.serial.send(this.connectionId,this._sendBufferArray[0],function(t){"pending"===t.error?console.warn("You cannot send serial data while another send is pending. Retrying."):t.error?(console.warn("Sending serial data failed. Error: "+t.error),this._sendBufferArray=[]):(this._sendBufferArray.shift(),this._sendCallbackArray.shift()()),this.sending=!1,this._sendBufferArray.length>0&&setImmediate(this._processBuffer.bind(this))}.bind(this)))},d.prototype.close=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.disconnect(this.connectionId,this.proxy("onClose",t))},d.prototype.onClose=function(t,e){this.connectionId=-1,this.isOpen=!1,this.emit("close"),this.removeAllListeners(),this._reader&&(this.options.serial.onReceive.removeListener(this._reader),this._reader=null),"function"==typeof t&&t(chrome.runtime.lastError,e)},d.prototype.flush=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");return void("function"==typeof t?t(e):this.emit("error",e))}let e=this;this.options.serial.flush(this.connectionId,(function(o){chrome.runtime.lastError?"function"==typeof t?t(chrome.runtime.lastError,o):e.emit("error",chrome.runtime.lastError):t(null,o)}))},d.prototype.drain=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else"function"==typeof t&&t()},d.prototype.pause=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!0,t)},d.prototype.resume=function(t){if(this.connectionId<0){this.isOpen=!1;let e=new Error("Serialport not open.");"function"==typeof t?t(e):this.emit("error",e)}else this.options.serial.setPaused(this.connectionId,!1,t)},d.prototype.update=function(t={},e=(()=>{})){if(this.connectionId<0){this.isOpen=!1;let t=new Error("Serialport not open.");"function"==typeof e?e(t):this.emit("error",t)}else this.options.serial.update(this.connectionId,{bitrate:t.baudRate},e)},d.prototype.proxy=function(){let t=this,e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];let o=e.splice(0,1)[0];return function(){let n=[];for(let t=0;t<arguments.length;t++)n[t]=arguments[t];let i=e.concat(n);t[o].apply(t,i)}},d.prototype.set=function(t,e){this.options.serial.setControlSignals(this.connectionId,t,(function(t){e(chrome.runtime.lastError,t)}))},d.prototype.get=function(t,e){this.options.serial.getControlSignals(this.connectionId,(function(t){e(chrome.runtime.lastError,t)}))},d.list=async function(t){if("undefined"!=typeof chrome&&chrome.serial)return new Promise(e=>{chrome.serial.getDevices((function(o){let n=new Array(o.length);for(let t=0;t<o.length;t++)n[t]={comName:o[t].path,path:o[t].path,manufacturer:o[t].displayName,serialNumber:"",pnpId:"",locationId:"",vendorId:"0x"+(o[t].vendorId||0).toString(16),productId:"0x"+(o[t].productId||0).toString(16)};"function"==typeof t&&t(chrome.runtime.lastError,n),e(n)}))});{let e=new Error("No access to serial ports. Try loading as a Chrome Application.");return t(e,null),Promise.reject(e)}},module.exports={SerialPort:d,list:d.list,buffer2ArrayBuffer:u,used:[]};
//# sourceMappingURL=chrome-apps-serialport.min.js.map
