{"version":3,"file":"chrome-apps-serialport.min.js","sources":["../src/chrome-apps-serialport.js"],"sourcesContent":["\"use strict\";\n\nconst EE = require(\"events\").EventEmitter;\nconst util = require(\"util\");\n\nconst DATABITS = [7, 8];\nconst STOPBITS = [1, 2];\nconst PARITY = [\"none\", \"even\", \"mark\", \"odd\", \"space\"];\nconst FLOWCONTROLS = [\"RTSCTS\"];\n\nconst _options = {\n  baudrate: 9600,\n  parity: \"none\",\n  rtscts: false,\n  databits: 8,\n  stopbits: 1,\n  buffersize: 256\n};\n\nfunction convertOptions(options) {\n\n  switch (options.dataBits) {\n    case 7:\n      options.dataBits = \"seven\";\n      break;\n    case 8:\n      options.dataBits = \"eight\";\n      break;\n  }\n\n  switch (options.stopBits) {\n    case 1:\n      options.stopBits = \"one\";\n      break;\n    case 2:\n      options.stopBits = \"two\";\n      break;\n  }\n\n  switch (options.parity) {\n    case \"none\":\n      options.parity = \"no\";\n      break;\n  }\n\n  return options;\n\n}\n\nfunction SerialPort(path, options, callback) {\n\n  EE.call(this);\n\n  let self = this;\n\n  this.sending = false;\n  this._sendBufferArray = [];\n  this._sendCallbackArray = [];\n\n  if (process && process.versions.nw && parseFloat(process.versions.nw) >= 0.13) {\n    require(\"nwjs-j5-fix\").fix(); // Fix issue with streams in NW.js\n  }\n\n  let args = Array.prototype.slice.call(arguments);\n  callback = args.pop();\n  if (typeof(callback) !== \"function\") callback = null;\n\n  options = (typeof options !== \"function\") && options || {};\n\n  if (options.autoOpen === undefined || options.autoOpen === null) {\n    options.autoOpen = true;\n  }\n\n  callback = callback || function (err) {\n    if (err) self.emit(\"error\", err);\n  };\n\n  let err;\n\n  options.baudRate = options.baudRate || options.baudrate || _options.baudrate;\n\n  options.dataBits = options.dataBits || options.databits || _options.databits;\n  if (DATABITS.indexOf(options.dataBits) === -1) {\n    err = new Error(\"Invalid \\\"databits\\\": \" + options.dataBits);\n    callback(err);\n    return;\n  }\n\n  options.stopBits = options.stopBits || options.stopbits || _options.stopbits;\n  if (STOPBITS.indexOf(options.stopBits) === -1) {\n    err = new Error(\"Invalid \\\"stopbits\\\": \" + options.stopbits);\n    callback(err);\n    return;\n  }\n\n  options.parity = options.parity || _options.parity;\n  if (PARITY.indexOf(options.parity) === -1) {\n    err = new Error(\"Invalid \\\"parity\\\": \" + options.parity);\n    callback(err);\n    return;\n  }\n\n  if (!path) {\n    err = new Error(\"Invalid port specified: \" + path);\n    callback(err);\n    return;\n  }\n\n  options.rtscts = _options.rtscts;\n\n  if (options.flowControl || options.flowcontrol) {\n    let fc = options.flowControl || options.flowcontrol;\n\n    if (typeof fc === \"boolean\") {\n      options.rtscts = true;\n    } else {\n      let clean = fc.every(function (flowControl) {\n        let fcup = flowControl.toUpperCase();\n        let idx = FLOWCONTROLS.indexOf(fcup);\n        if (idx < 0) {\n          let err = new Error(\"Invalid \\\"flowControl\\\": \" + fcup + \". Valid options: \" +\n            FLOWCONTROLS.join(\"\"));\n          callback(err);\n          return false;\n        } else {\n\n          // \"XON\", \"XOFF\", \"XANY\", \"DTRDTS\", \"RTSCTS\"\n          switch (idx) {\n            case 0: options.rtscts = true; break;\n          }\n          return true;\n        }\n      });\n      if(!clean){\n        return;\n      }\n    }\n  }\n\n  options.bufferSize = options.bufferSize || options.buffersize || _options.buffersize;\n\n  // defaults to chrome.serial if no options.serial passed\n  // inlined instead of on _options to allow mocking global chrome.serial for optional options test\n  options.serial = options.serial || (typeof chrome !== \"undefined\" && chrome.serial);\n\n  if (!options.serial) {\n    throw new Error(\"No access to serial ports. Try loading as a Chrome Application.\");\n  }\n\n  this.options = convertOptions(options);\n\n  this.options.serial.onReceiveError.addListener(function(info){\n\n    switch (info.error) {\n\n      case \"disconnected\":\n      case \"device_lost\":\n      case \"system_error\":\n        err = new Error(\"Disconnected\");\n        // send notification of disconnect\n        if (self.options.disconnectedCallback) {\n          self.options.disconnectedCallback(err);\n        } else {\n          self.emit(\"disconnect\", err);\n        }\n        if(self.connectionId >= 0){\n          self.close();\n        }\n        break;\n      case \"timeout\":\n        break;\n    }\n\n  });\n\n  this.path = path;\n  this.isOpen = false;\n  this.baudRate = this.options.baudRate;\n\n  if (options.autoOpen) {\n    process.nextTick(function () {\n      self.open(callback);\n    });\n  }\n\n}\n\nutil.inherits(SerialPort, EE);\n\nSerialPort.prototype.connectionId = -1;\n\nSerialPort.prototype.open = function (callback) {\n\n  let options = {\n    bitrate: parseInt(this.options.baudRate, 10),\n    dataBits: this.options.dataBits,\n    parityBit: this.options.parity,\n    stopBits: this.options.stopBits,\n    ctsFlowControl: this.options.rtscts\n  };\n\n  this.options.serial.connect(this.path, options, this.proxy(\"onOpen\", callback));\n\n};\n\nSerialPort.prototype.onOpen = function (callback, openInfo) {\n  if(chrome.runtime.lastError){\n    if(typeof callback === \"function\"){\n      callback(chrome.runtime.lastError);\n    }else{\n      this.emit(\"error\", chrome.runtime.lastError);\n    }\n    return;\n  }\n\n  this.connectionId = openInfo.connectionId;\n\n  if (this.connectionId === -1) {\n    this.emit(\"error\", new Error(\"Could not open port.\"));\n    return;\n  }\n\n  this.isOpen = true;\n  this.emit(\"open\", openInfo);\n\n  this._reader = this.proxy(\"onRead\");\n\n  this.options.serial.onReceive.addListener(this._reader);\n\n  if(typeof callback === \"function\"){\n    callback(chrome.runtime.lastError, openInfo);\n  }\n};\n\nSerialPort.prototype.onRead = function (readInfo) {\n  if (readInfo && this.connectionId === readInfo.connectionId) {\n\n    if (this.options.dataCallback) {\n      this.options.dataCallback(toBuffer(readInfo.data));\n    } else {\n      this.emit(\"data\", toBuffer(readInfo.data));\n    }\n\n  }\n};\n\nSerialPort.prototype.write = function (buffer, encoding = \"utf8\", callback = () => {}) {\n\n  // This is for backwards-compatibility (when \"encoding\" is omitted)\n  if (typeof encoding !== \"string\" && !(encoding instanceof String)) {\n    callback = encoding;\n    encoding = \"utf8\";\n  }\n\n  if (encoding !== \"utf8\") console.warn(\"Only utf8 encoding is supported for strings.\");\n\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if (typeof callback === \"function\") callback(err);\n    this.emit(\"error\", err);\n    return;\n  }\n\n  if (typeof buffer === \"string\") buffer = str2ab(buffer);\n\n  // chrome.serial needs an ArrayBuffer not a Buffer\n  if (!(buffer instanceof ArrayBuffer)) buffer = buffer2ArrayBuffer(buffer);\n\n  // Process whats in the buffer\n  this._processBuffer(buffer, callback);\n\n};\n\nSerialPort.prototype._processBuffer = function (buffer, callback) {\n\n  if (buffer) this._sendBufferArray.push(buffer);\n\n  if (typeof callback === \"function\") {\n    this._sendCallbackArray.push(callback);\n  } else {\n    this._sendCallbackArray.push(() => {});\n  }\n\n  if (this.sending) return;\n  this.sending = true;\n\n  this.options.serial.send(this.connectionId, this._sendBufferArray[0], function(info) {\n\n    if (info.error === \"pending\") {\n      console.warn(\"You cannot send serial data while another send is pending. Retrying.\");\n    } else if (info.error) {\n      console.warn(\"Sending serial data failed. Error: \" + info.error);\n      this._sendBufferArray = [];\n    } else {\n      this._sendBufferArray.shift(); // remove buffer that was just sent\n      this._sendCallbackArray.shift()(); // execute matching callback\n    }\n\n    this.sending = false;\n    if (this._sendBufferArray.length > 0) setImmediate(this._processBuffer.bind(this));\n\n  }.bind(this));\n\n};\n\nSerialPort.prototype.close = function (callback) {\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  this.options.serial.disconnect(this.connectionId, this.proxy(\"onClose\", callback));\n};\n\nSerialPort.prototype.onClose = function (callback, result) {\n  this.connectionId = -1;\n  this.isOpen = false;\n  this.emit(\"close\");\n\n  this.removeAllListeners();\n  if(this._reader){\n    this.options.serial.onReceive.removeListener(this._reader);\n    this._reader = null;\n  }\n\n  if (typeof callback === \"function\") {\n    callback(chrome.runtime.lastError, result);\n  }\n};\n\nSerialPort.prototype.flush = function (callback) {\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  let self = this;\n\n  this.options.serial.flush(this.connectionId, function(result) {\n    if (chrome.runtime.lastError) {\n      if (typeof callback === \"function\") {\n        callback(chrome.runtime.lastError, result);\n      } else {\n        self.emit(\"error\", chrome.runtime.lastError);\n      }\n    } else {\n      callback(null, result);\n    }\n  });\n};\n\nSerialPort.prototype.drain = function (callback) {\n\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if (typeof callback === \"function\") {\n      callback(err);\n    } else {\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  if (typeof callback === \"function\") {\n    callback();\n  }\n\n};\n\nSerialPort.prototype.pause = function (callback) {\n\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if (typeof callback === \"function\") {\n      callback(err);\n    } else {\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  this.options.serial.setPaused(this.connectionId, true, callback);\n\n};\n\nSerialPort.prototype.resume = function (callback) {\n\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if (typeof callback === \"function\") {\n      callback(err);\n    } else {\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  this.options.serial.setPaused(this.connectionId, false, callback);\n\n};\n\nSerialPort.prototype.update = function (options = {}, callback = () => {}) {\n\n  if (this.connectionId < 0) {\n    this.isOpen = false;\n    let err = new Error(\"Serialport not open.\");\n    if (typeof callback === \"function\") {\n      callback(err);\n    } else {\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  this.options.serial.update(this.connectionId, {bitrate: options.baudRate}, callback);\n\n};\n\nSerialPort.prototype.proxy = function () {\n  let self = this;\n  let proxyArgs = [];\n\n  //arguments isnt actually an array.\n  for (let i = 0; i < arguments.length; i++) {\n    proxyArgs[i] = arguments[i];\n  }\n\n  let functionName = proxyArgs.splice(0, 1)[0];\n\n  return function() {\n    let funcArgs = [];\n    for (let i = 0; i < arguments.length; i++) {\n      funcArgs[i] = arguments[i];\n    }\n    let allArgs = proxyArgs.concat(funcArgs);\n\n    self[functionName].apply(self, allArgs);\n  };\n\n};\n\nSerialPort.prototype.set = function (options, callback) {\n  this.options.serial.setControlSignals(this.connectionId, options, function(result){\n    callback(chrome.runtime.lastError, result);\n  });\n};\n\nSerialPort.prototype.get = function (options, callback) {\n  this.options.serial.getControlSignals(this.connectionId, function(signals){\n    callback(chrome.runtime.lastError, signals);\n  });\n};\n\nSerialPort.list = async function(callback) {\n\n  if (typeof chrome != \"undefined\" && chrome.serial) {\n\n    return new Promise(resolve => {\n\n      chrome.serial.getDevices(function(ports) {\n\n        let portObjects = new Array(ports.length);\n\n        for (let i = 0; i < ports.length; i++) {\n          portObjects[i] = {\n            comName: ports[i].path, // backwards-compatibility with older versions of serialport\n            path: ports[i].path,\n            manufacturer: ports[i].displayName,\n            serialNumber: \"\",\n            pnpId: \"\",\n            locationId:\"\",\n            vendorId: \"0x\" + (ports[i].vendorId||0).toString(16),\n            productId: \"0x\" + (ports[i].productId||0).toString(16)\n          };\n        }\n\n        if (typeof callback === \"function\") callback(chrome.runtime.lastError, portObjects);\n        resolve(portObjects);\n\n      });\n\n    });\n\n  } else {\n    let error = new Error(\"No access to serial ports. Try loading as a Chrome Application.\");\n    callback(error, null);\n    return Promise.reject(error);\n  }\n\n};\n\n// Convert string to ArrayBuffer\nfunction str2ab(str) {\n  let buf = new ArrayBuffer(str.length);\n  let bufView = new Uint8Array(buf);\n  for (let i = 0; i < str.length; i++) {\n    bufView[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction buffer2ArrayBuffer(buf) {\n  return new Uint8Array(buf).buffer;\n}\n\nfunction toBuffer(ab) {\n  let buffer = new Buffer(ab.byteLength);\n  let view = new Uint8Array(ab);\n  for (let i = 0; i < buffer.length; ++i) {\n    buffer[i] = view[i];\n  }\n  return buffer;\n}\n\nmodule.exports = {\n  SerialPort: SerialPort,\n  list: SerialPort.list, // this is for backwards-compatibility\n  buffer2ArrayBuffer: buffer2ArrayBuffer,\n  used: [] //Populate this somewhere!!\n};\n"],"names":["EE","require","EventEmitter","util","DATABITS","STOPBITS","PARITY","FLOWCONTROLS","_options","convertOptions","options","dataBits","stopBits","parity","SerialPort","path","callback","call","this","self","sending","_sendBufferArray","_sendCallbackArray","process","versions","nw","parseFloat","fix","err","args","Array","prototype","slice","arguments","pop","undefined","autoOpen","emit","baudRate","baudrate","databits","indexOf","Error","stopbits","rtscts","flowControl","flowcontrol","fc","every","fcup","toUpperCase","idx","join","bufferSize","buffersize","serial","chrome","onReceiveError","addListener","info","error","disconnectedCallback","connectionId","close","isOpen","nextTick","open","buffer2ArrayBuffer","buf","Uint8Array","buffer","toBuffer","ab","Buffer","byteLength","view","i","length","inherits","bitrate","parseInt","parityBit","ctsFlowControl","connect","proxy","onOpen","openInfo","runtime","lastError","_reader","onReceive","onRead","readInfo","dataCallback","data","write","encoding","String","console","warn","str","ArrayBuffer","bufView","charCodeAt","str2ab","_processBuffer","push","send","shift","setImmediate","bind","disconnect","onClose","result","removeAllListeners","removeListener","flush","drain","pause","setPaused","resume","update","proxyArgs","functionName","splice","funcArgs","allArgs","concat","apply","set","setControlSignals","get","getControlSignals","signals","list","async","Promise","resolve","getDevices","ports","portObjects","comName","manufacturer","displayName","serialNumber","pnpId","locationId","vendorId","toString","productId","reject","module","exports","used"],"mappings":"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"}