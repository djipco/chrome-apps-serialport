{"version":3,"file":"chrome-apps-serialport.min.js","sources":["../src/chrome-apps-serialport.js"],"sourcesContent":["\"use strict\";\n\nconst EE = require(\"events\").EventEmitter;\nconst util = require(\"util\");\n\nif (process && process.versions.nw && parseFloat(process.versions.nw) >= 0.13) {\n  require(\"nwjs-j5-fix\").fix(); // Fix issue with streams in NW.js\n}\n\nconst DATABITS = [7, 8];\nconst STOPBITS = [1, 2];\nconst PARITY = [\"none\", \"even\", \"mark\", \"odd\", \"space\"];\nconst FLOWCONTROLS = [\"RTSCTS\"];\n\nconst _options = {\n  baudrate: 9600,\n  parity: \"none\",\n  rtscts: false,\n  databits: 8,\n  stopbits: 1,\n  buffersize: 256\n};\n\nfunction convertOptions(options){\n  switch (options.dataBits) {\n    case 7:\n      options.dataBits = \"seven\";\n      break;\n    case 8:\n      options.dataBits = \"eight\";\n      break;\n  }\n\n  switch (options.stopBits) {\n    case 1:\n      options.stopBits = \"one\";\n      break;\n    case 2:\n      options.stopBits = \"two\";\n      break;\n  }\n\n  switch (options.parity) {\n    case \"none\":\n      options.parity = \"no\";\n      break;\n  }\n\n  return options;\n}\n\nfunction SerialPort(path, options, openImmediately, callback) {\n\n  EE.call(this);\n\n  let self = this;\n\n  let args = Array.prototype.slice.call(arguments);\n  callback = args.pop();\n  if (typeof(callback) !== \"function\") {\n    callback = null;\n  }\n\n  options = (typeof options !== \"function\") && options || {};\n\n  if (openImmediately === undefined || openImmediately === null) {\n    openImmediately = true;\n  }\n\n  callback = callback || function (err) {\n    if (err) {\n      self.emit(\"error\", err);\n    }\n  };\n\n  let err;\n\n  options.baudRate = options.baudRate || options.baudrate || _options.baudrate;\n\n  options.dataBits = options.dataBits || options.databits || _options.databits;\n  if (DATABITS.indexOf(options.dataBits) === -1) {\n    err = new Error(\"Invalid \\\"databits\\\": \" + options.dataBits);\n    callback(err);\n    return;\n  }\n\n  options.stopBits = options.stopBits || options.stopbits || _options.stopbits;\n  if (STOPBITS.indexOf(options.stopBits) === -1) {\n    err = new Error(\"Invalid \\\"stopbits\\\": \" + options.stopbits);\n    callback(err);\n    return;\n  }\n\n  options.parity = options.parity || _options.parity;\n  if (PARITY.indexOf(options.parity) === -1) {\n    err = new Error(\"Invalid \\\"parity\\\": \" + options.parity);\n    callback(err);\n    return;\n  }\n\n  if (!path) {\n    err = new Error(\"Invalid port specified: \" + path);\n    callback(err);\n    return;\n  }\n\n  options.rtscts = _options.rtscts;\n\n  if (options.flowControl || options.flowcontrol) {\n    let fc = options.flowControl || options.flowcontrol;\n\n    if (typeof fc === \"boolean\") {\n      options.rtscts = true;\n    } else {\n      let clean = fc.every(function (flowControl) {\n        let fcup = flowControl.toUpperCase();\n        let idx = FLOWCONTROLS.indexOf(fcup);\n        if (idx < 0) {\n          let err = new Error(\"Invalid \\\"flowControl\\\": \" + fcup + \". Valid options: \" +\n            FLOWCONTROLS.join(\"\", \"\"));\n          callback(err);\n          return false;\n        } else {\n\n          // \"XON\", \"XOFF\", \"XANY\", \"DTRDTS\", \"RTSCTS\"\n          switch (idx) {\n            case 0: options.rtscts = true; break;\n          }\n          return true;\n        }\n      });\n      if(!clean){\n        return;\n      }\n    }\n  }\n\n  options.bufferSize = options.bufferSize || options.buffersize || _options.buffersize;\n\n  // defaults to chrome.serial if no options.serial passed\n  // inlined instead of on _options to allow mocking global chrome.serial for optional options test\n  options.serial = options.serial || (typeof chrome !== \"undefined\" && chrome.serial);\n\n  if (!options.serial) {\n    throw new Error(\"No access to serial ports. Try loading as a Chrome Application.\");\n  }\n\n  this.options = convertOptions(options);\n\n  this.options.serial.onReceiveError.addListener(function(info){\n\n    switch (info.error) {\n\n      case \"disconnected\":\n      case \"device_lost\":\n      case \"system_error\":\n        err = new Error(\"Disconnected\");\n        // send notification of disconnect\n        if (self.options.disconnectedCallback) {\n          self.options.disconnectedCallback(err);\n        } else {\n          self.emit(\"disconnect\", err);\n        }\n        if(self.connectionId >= 0){\n          self.close();\n        }\n        break;\n      case \"timeout\":\n        break;\n    }\n\n  });\n\n  this.path = path;\n\n  if (openImmediately) {\n    process.nextTick(function () {\n      self.open(callback);\n    });\n  }\n}\n\nutil.inherits(SerialPort, EE);\n\nSerialPort.prototype.connectionId = -1;\n\nSerialPort.prototype.open = function (callback) {\n  let options = {\n    bitrate: parseInt(this.options.baudRate, 10),\n    dataBits: this.options.dataBits,\n    parityBit: this.options.parity,\n    stopBits: this.options.stopBits,\n    ctsFlowControl: this.options.rtscts\n  };\n\n  this.options.serial.connect(this.path, options, this.proxy(\"onOpen\", callback));\n};\n\nSerialPort.prototype.onOpen = function (callback, openInfo) {\n  if(chrome.runtime.lastError){\n    if(typeof callback === \"function\"){\n      callback(chrome.runtime.lastError);\n    }else{\n      this.emit(\"error\", chrome.runtime.lastError);\n    }\n    return;\n  }\n\n  this.connectionId = openInfo.connectionId;\n\n  if (this.connectionId === -1) {\n    this.emit(\"error\", new Error(\"Could not open port.\"));\n    return;\n  }\n\n  this.emit(\"open\", openInfo);\n\n  this._reader = this.proxy(\"onRead\");\n\n  this.options.serial.onReceive.addListener(this._reader);\n\n  if(typeof callback === \"function\"){\n    callback(chrome.runtime.lastError, openInfo);\n  }\n};\n\nSerialPort.prototype.onRead = function (readInfo) {\n  if (readInfo && this.connectionId === readInfo.connectionId) {\n\n    if (this.options.dataCallback) {\n      this.options.dataCallback(toBuffer(readInfo.data));\n    } else {\n      this.emit(\"data\", toBuffer(readInfo.data));\n    }\n\n  }\n};\n\nSerialPort.prototype.write = function (buffer, callback) {\n  if (this.connectionId < 0) {\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  if (typeof buffer === \"string\") {\n    buffer = str2ab(buffer);\n  }\n\n  //Make sure its not a browserify faux Buffer.\n  if (!(buffer instanceof ArrayBuffer)) {\n    buffer = buffer2ArrayBuffer(buffer);\n  }\n\n  this.options.serial.send(this.connectionId, buffer, function(info) {\n    if (typeof callback === \"function\") {\n      callback(chrome.runtime.lastError, info);\n    }\n  });\n};\n\n\nSerialPort.prototype.close = function (callback) {\n  if (this.connectionId < 0) {\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  this.options.serial.disconnect(this.connectionId, this.proxy(\"onClose\", callback));\n};\n\nSerialPort.prototype.onClose = function (callback, result) {\n  this.connectionId = -1;\n  this.emit(\"close\");\n\n  this.removeAllListeners();\n  if(this._reader){\n    this.options.serial.onReceive.removeListener(this._reader);\n    this._reader = null;\n  }\n\n  if (typeof callback === \"function\") {\n    callback(chrome.runtime.lastError, result);\n  }\n};\n\nSerialPort.prototype.flush = function (callback) {\n  if (this.connectionId < 0) {\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  let self = this;\n\n  this.options.serial.flush(this.connectionId, function(result) {\n    if (chrome.runtime.lastError) {\n      if (typeof callback === \"function\") {\n        callback(chrome.runtime.lastError, result);\n      } else {\n        self.emit(\"error\", chrome.runtime.lastError);\n      }\n    } else {\n      callback(null, result);\n    }\n  });\n};\n\nSerialPort.prototype.drain = function (callback) {\n  if (this.connectionId < 0) {\n    let err = new Error(\"Serialport not open.\");\n    if(typeof callback === \"function\"){\n      callback(err);\n    }else{\n      this.emit(\"error\", err);\n    }\n    return;\n  }\n\n  if (typeof callback === \"function\") {\n    callback();\n  }\n};\n\n\nSerialPort.prototype.proxy = function () {\n  let self = this;\n  let proxyArgs = [];\n\n  //arguments isnt actually an array.\n  for (let i = 0; i < arguments.length; i++) {\n    proxyArgs[i] = arguments[i];\n  }\n\n  let functionName = proxyArgs.splice(0, 1)[0];\n\n  return function() {\n    let funcArgs = [];\n    for (let i = 0; i < arguments.length; i++) {\n      funcArgs[i] = arguments[i];\n    }\n    let allArgs = proxyArgs.concat(funcArgs);\n\n    self[functionName].apply(self, allArgs);\n  };\n\n};\n\nSerialPort.prototype.set = function (options, callback) {\n  this.options.serial.setControlSignals(this.connectionId, options, function(result){\n    callback(chrome.runtime.lastError, result);\n  });\n};\n\nSerialPort.prototype.isOpen = function () {\n  return this.connectionId > -1;\n};\n\nSerialPort.list = async function(callback) {\n\n  if (typeof chrome != \"undefined\" && chrome.serial) {\n\n    return new Promise(resolve => {\n\n      chrome.serial.getDevices(function(ports) {\n\n        let portObjects = new Array(ports.length);\n\n        for (let i = 0; i < ports.length; i++) {\n          portObjects[i] = {\n            comName: ports[i].path, // backwards-compatibility with older versions of serialport\n            path: ports[i].path,\n            manufacturer: ports[i].displayName,\n            serialNumber: \"\",\n            pnpId: \"\",\n            locationId:\"\",\n            vendorId: \"0x\" + (ports[i].vendorId||0).toString(16),\n            productId: \"0x\" + (ports[i].productId||0).toString(16)\n          };\n        }\n\n        if (typeof callback === \"function\") callback(chrome.runtime.lastError, portObjects);\n        resolve(portObjects);\n\n      });\n\n    });\n\n  } else {\n    let error = new Error(\"No access to serial ports. Try loading as a Chrome Application.\");\n    callback(error, null);\n    return Promise.reject(error);\n  }\n\n};\n\n// Convert string to ArrayBuffer\nfunction str2ab(str) {\n  let buf = new ArrayBuffer(str.length);\n  let bufView = new Uint8Array(buf);\n  for (let i = 0; i < str.length; i++) {\n    bufView[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n\n// Convert buffer to ArrayBuffer\nfunction buffer2ArrayBuffer(buffer) {\n  let buf = new ArrayBuffer(buffer.length);\n  let bufView = new Uint8Array(buf);\n  for (let i = 0; i < buffer.length; i++) {\n    bufView[i] = buffer[i];\n  }\n  return buf;\n}\n\nfunction toBuffer(ab) {\n  let buffer = new Buffer(ab.byteLength);\n  let view = new Uint8Array(ab);\n  for (let i = 0; i < buffer.length; ++i) {\n    buffer[i] = view[i];\n  }\n  return buffer;\n}\n\nmodule.exports = {\n  SerialPort: SerialPort,\n  list: SerialPort.list, // this is for backwards-compatibility\n  buffer2ArrayBuffer: buffer2ArrayBuffer,\n  used: [] //Populate this somewhere!!\n};\n"],"names":["EE","require","EventEmitter","util","process","versions","nw","parseFloat","fix","DATABITS","STOPBITS","PARITY","FLOWCONTROLS","_options","convertOptions","options","dataBits","stopBits","parity","SerialPort","path","openImmediately","callback","call","this","err","self","args","Array","prototype","slice","arguments","pop","emit","baudRate","baudrate","databits","indexOf","Error","stopbits","rtscts","flowControl","flowcontrol","fc","every","fcup","toUpperCase","idx","join","bufferSize","buffersize","serial","chrome","onReceiveError","addListener","info","error","disconnectedCallback","connectionId","close","nextTick","open","buffer2ArrayBuffer","buffer","buf","ArrayBuffer","length","bufView","Uint8Array","i","toBuffer","ab","Buffer","byteLength","view","inherits","bitrate","parseInt","parityBit","ctsFlowControl","connect","proxy","onOpen","openInfo","runtime","lastError","_reader","onReceive","onRead","readInfo","dataCallback","data","write","str","charCodeAt","str2ab","send","disconnect","onClose","result","removeAllListeners","removeListener","flush","drain","proxyArgs","functionName","splice","funcArgs","allArgs","concat","apply","set","setControlSignals","isOpen","list","async","Promise","resolve","getDevices","ports","portObjects","comName","manufacturer","displayName","serialNumber","pnpId","locationId","vendorId","toString","productId","reject","module","exports","used"],"mappings":"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"}